// EXPECTED_OUTPUT: Writing to terminal async...
// EXPECTED_OUTPUT: Hello from io_uring!
// EXPECTED_OUTPUT: Bytes written: 21

#include "std/io.eth"

i32 task(i32 id) {
    string msg1 = "Task 1 running!\n";
    string msg2 = "Task 2 running!\n";
    for (i32 i = 0; i < 10; i++) {
        if (id == 1) {
            write(1, "Task", 4);
            // write(1, msg1, 16);
            write(1, "Finished", 8);
            write(1, "\n", 1);
            yield;
        } else {
            await co_write(1, msg2, 16);
        }
    }
    return id;
}

i32 main() {
    printf("Writing to terminal async...\n");
    coroutine(i32) t1 = spawn task(1);
    coroutine(i32) t2 = spawn task(2);
    await t1;
    await t2;
    i32 written = await co_write(1, "Hello from io_uring!\n", 21);
    printf("Bytes written: %d\n", written);
    return 0;
}
