
// EXPECTED_OUTPUT: Starting sleep test...
// EXPECTED_OUTPUT: Sleeping for 1ms...
// EXPECTED_OUTPUT: Sleeping for 50ms...
// EXPECTED_OUTPUT: Waiting for tasks...
// EXPECTED_OUTPUT: Done sleeping 1ms
// EXPECTED_OUTPUT: Task 1 result: 1
// EXPECTED_OUTPUT: Done sleeping 50ms
// EXPECTED_OUTPUT: Task 2 result: 2
// EXPECTED_OUTPUT: All done!

#include "std/io.eth"

i32 task(i32 id, i32 ms) {
    printf("Sleeping for %dms...\n", ms);
    await co_sleep(ms);
    printf("Done sleeping %dms\n", ms);
    return id;
}

i32 main() {
    printf("Starting sleep test...\n");
    
    coroutine(i32) t1 = spawn task(1, 1);
    coroutine(i32) t2 = spawn task(2, 50);

    printf("Waiting for tasks...\n");
    i32 res1 = await t1;
    printf("Task 1 result: %d\n", res1);
    i32 res2 = await t2;
    printf("Task 2 result: %d\n", res2);
    
    printf("All done!\n");
    return 0;
}
