// EXPECTED_OUTPUT: Starting worker...
// EXPECTED_OUTPUT: Worker 1: loop 0
// EXPECTED_OUTPUT: Worker 2: loop 0
// EXPECTED_OUTPUT: Waiting for worker 1...
// EXPECTED_OUTPUT: Worker 1: loop 1
// EXPECTED_OUTPUT: Worker 2: loop 1
// EXPECTED_OUTPUT: Worker 1: loop 2
// EXPECTED_OUTPUT: Worker 2: loop 2
// EXPECTED_OUTPUT: Worker 1: loop 3
// EXPECTED_OUTPUT: Worker 1: loop 4
// EXPECTED_OUTPUT: Worker 1 result: 10
// EXPECTED_OUTPUT: Waiting for worker 2...
// EXPECTED_OUTPUT: Worker 2 result: 3
// EXPECTED_RESULT: 13
#include "std/io.eth"

i32 worker(i32 id, i32 count) {
    i32 sum = 0;
    for (i32 i = 0; i < count; i++) {
        printf("Worker %d: loop %d\n", id, i);
        sum = sum + i;
        yield;
    }
    return sum;
}

i32 main() {
    printf("Starting worker...\n");
    coroutine(i32) h1 = spawn worker(1, 5);
    coroutine(i32) h2 = spawn worker(2, 3);
    
    printf("Waiting for worker 1...\n");
    i32 res1 = await h1;
    printf("Worker 1 result: %d\n", res1);
    
    printf("Waiting for worker 2...\n");
    i32 res2 = await h2;
    printf("Worker 2 result: %d\n", res2);
    
    return res1 + res2;
}
