// ARGS: --dump-ir
// EXPECTED_OUTPUT: <function: create_array> (params: 0, slots: 1)
// EXPECTED_OUTPUT: CALL                addr 47 args 1 <malloc>
// EXPECTED_OUTPUT: STORE_VAR           slot 0 size 1
// EXPECTED_OUTPUT: PUSH_I32            10
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: STORE_PTR_OFFSET    offset 0 size 1
// EXPECTED_OUTPUT: PUSH_I32            20
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: STORE_PTR_OFFSET    offset 0 size 1
// EXPECTED_OUTPUT: PUSH_I32            30
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: STORE_PTR_OFFSET    offset 0 size 1
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: RET                 size 1
// EXPECTED_OUTPUT: <function: main> (params: 0, slots: 4)
// EXPECTED_OUTPUT: CALL                addr 71 args 0 <create_array>
// EXPECTED_OUTPUT: STORE_VAR           slot 0 size 1
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: LOAD_PTR_OFFSET     offset 0 size 1
// EXPECTED_OUTPUT: STORE_VAR           slot 1 size 1
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: LOAD_PTR_OFFSET     offset 0 size 1
// EXPECTED_OUTPUT: STORE_VAR           slot 2 size 1
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: LOAD_PTR_OFFSET     offset 0 size 1
// EXPECTED_OUTPUT: STORE_VAR           slot 3 size 1
// EXPECTED_OUTPUT: CALL                addr 34 args 4 <printf>
// EXPECTED_OUTPUT: LOAD_VAR            slot 0 size 1
// EXPECTED_OUTPUT: CALL                addr 59 args 1 <free>
// EXPECTED_OUTPUT: PUSH_I32            0
// EXPECTED_OUTPUT: RET                 size 1
#include "std/io.eth"

// Function that creates and returns a pointer to a heap-allocated array
ptr(i32) create_array() {
    ptr(i32) arr = malloc(3 * sizeof(i32));
    arr[0] = 10;
    arr[1] = 20;
    arr[2] = 30;
    return arr;
}

i32 main() {
    ptr(i32) my_arr = create_array();
    
    i32 val0 = my_arr[0];
    i32 val1 = my_arr[1];
    i32 val2 = my_arr[2];

    printf("Values: %d, %d, %d\n", val0, val1, val2);

    free(my_arr);
    return 0;
}